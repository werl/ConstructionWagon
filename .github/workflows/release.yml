name: release

on:
  release:
    types: [published]

jobs:
  publish-mod:
    environment: Mod Upload
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
          node-version: '20'

    - name: Validate Mod
      uses: TheBrutalX/factorio-mod-uploader-action@v1.1.0
      with:
          action: validate

    - name: Create zip
      uses: TheBrutalX/factorio-mod-uploader-action@v1.1.0
      with:
          action: compress
    - name: Upload To Relese
      uses: Shopify/upload-to-release@v2.0.0
      with:
        name: ${{ steps.vars.outputs.ZIP_FILE }}.zip
        path: ${{ steps.vars.outputs.ZIP_FILE }}.zip
        repo-token: ${{ secrets.GITHUB_TOKEN }}
        content-type: application/zip
    - name: Upload Mod
      uses: TheBrutalX/factorio-mod-uploader-action@v1.1.0
      with:
          action: upload
          factorio-api-key: ${{ secrets.FACTORIO_TOKEN }}